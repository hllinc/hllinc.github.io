<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>AI 内容理解平台技术方案</title>
      <link href="/2024/12/13/aiuc-technical-proposal/"/>
      <url>/2024/12/13/aiuc-technical-proposal/</url>
      
        <content type="html"><![CDATA[<h1 id="系统架构图"><a href="#系统架构图" class="headerlink" title="系统架构图"></a>系统架构图</h1><h2 id="功能模块"><a href="#功能模块" class="headerlink" title="功能模块"></a>功能模块</h2><img src="/2024/12/13/aiuc-technical-proposal/wps8.png" class="" title="img"><ul><li>多模态模型： <ul><li>实现音频、视频、图片的解析功能；</li></ul></li><li>语言处理模型：关键词提取等。</li><li>内容生成模型：生成摘要和总结。</li></ul><h2 id="技术架构图"><a href="#技术架构图" class="headerlink" title="技术架构图"></a>技术架构图</h2><img src="/2024/12/13/aiuc-technical-proposal/wps9.png" class="" title="img"><h2 id="业务数据流程图"><a href="#业务数据流程图" class="headerlink" title="业务数据流程图"></a>业务数据流程图</h2><img src="/2024/12/13/aiuc-technical-proposal/wps11.png" class="" title="img"><h2 id="代码工程结构图"><a href="#代码工程结构图" class="headerlink" title="代码工程结构图"></a>代码工程结构图</h2><h3 id="Web-服务工程结构"><a href="#Web-服务工程结构" class="headerlink" title="Web 服务工程结构"></a>Web 服务工程结构</h3><img src="/2024/12/13/aiuc-technical-proposal/wps12.png" class="" title="img"><h1 id="关键技术点"><a href="#关键技术点" class="headerlink" title="关键技术点"></a>关键技术点</h1><h2 id="全文总结文章内容长度超过模型处理上限"><a href="#全文总结文章内容长度超过模型处理上限" class="headerlink" title="全文总结文章内容长度超过模型处理上限"></a>全文总结文章内容长度超过模型处理上限</h2><p>工程层：工程层面会按业务场景约束文件的大小，然后一次发送全部内容给到模型。</p><p>模型层：将文章分为多段进行处理，再将每次的结果合并成一个新的文章，再次进行处理，最终返回摘要总结。</p><h1 id="功能模块设计"><a href="#功能模块设计" class="headerlink" title="功能模块设计"></a>功能模块设计</h1><img src="/2024/12/13/aiuc-technical-proposal/wps13.png" class="" title="img"><h2 id="数据采集服务"><a href="#数据采集服务" class="headerlink" title="数据采集服务"></a>数据采集服务</h2><h3 id="主流视频、内容网站"><a href="#主流视频、内容网站" class="headerlink" title="主流视频、内容网站"></a>主流视频、内容网站</h3><p>计划每天各主流网站按 Top 10 抓取，预计每天数据量在200条左右。</p><ul><li>小红书、知乎、公众号</li><li>B站、快手、抖音(pc端)</li><li>新浪、搜狐、网易、腾讯新闻</li><li>tt、youtobe</li><li>科技文献（主要AI圈），待确定</li></ul><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><ul><li>word&#x2F;pdf&#x2F;txt&#x2F;ppt等文本内容 <ul><li>仅文本层面处理 </li><li>文本、图片都识别</li></ul></li></ul><h3 id="网盘"><a href="#网盘" class="headerlink" title="网盘"></a>网盘</h3><ul><li>百度网盘地址 </li><li>夸克网盘地址</li></ul><p>对接网盘，需要用户自己的网盘密钥。</p><h2 id="文件解析服务"><a href="#文件解析服务" class="headerlink" title="文件解析服务"></a>文件解析服务</h2><h3 id="视频、音频、图片解析"><a href="#视频、音频、图片解析" class="headerlink" title="视频、音频、图片解析"></a>视频、音频、图片解析</h3><p>多模态模型提供能力支持。</p><p>图片、音频、视频，明超这边的多模态服务已计划支持，目前正在开发中，具体排期未定。</p><h3 id="文档文件解析"><a href="#文档文件解析" class="headerlink" title="文档文件解析"></a>文档文件解析</h3><p>需要对 pdf、word、txt、ppt 格式的文档进行文本解析。</p><p><strong>存在的问题，对纯文本、排版规范的文件可以很好的识别，但是对存在图片或排版不规范的无法保证100%识别。</strong></p><p>可行方案列表：</p><table><thead><tr><th>方案</th><th>特性</th><th>价格</th><th>链接</th></tr></thead><tbody><tr><td>腾讯云</td><td></td><td>200元&#x2F;千次</td><td></td></tr><tr><td>阿里云</td><td>1. 电子文档解析，支持 word、excel、html、epub、mobi、markdown、txt、ppt 格式2. 文档抽取，支持 pdf 文件</td><td>按量计费文档理解：500页&#x2F;108元阶梯收费</td><td><a href="https://help.aliyun.com/zh/document-mind/developer-reference/digitaldocstructure?spm=a2c4g.11186623.0.0.417258fc1UWIqzhttps://help.aliyun.com/zh/document-mind/product-overview/resource-plans?spm=a2c4g.11186623.0.0.1e571137ynMX1V">https://help.aliyun.com/zh/document-mind/developer-reference/digitaldocstructure?spm=a2c4g.11186623.0.0.417258fc1UWIqzhttps://help.aliyun.com/zh/document-mind/product-overview/resource-plans?spm=a2c4g.11186623.0.0.1e571137ynMX1V</a></td></tr><tr><td>gugudata</td><td>Pdf 解析</td><td>1499元&#x2F;年</td><td><a href="https://www.gugudata.com/api/details/pdf2format">https://www.gugudata.com/api/details/pdf2format</a></td></tr><tr><td>LightPDF</td><td>PDF, Word, Excel, PPT, EPUB, TXT, webpage (url), scanned files supported</td><td>159$&#x2F;年&#x2F;10000 credits</td><td><a href="https://lightpdf.com/chatdoc">https://lightpdf.com/chatdoc</a></td></tr><tr><td>FileParseUtil</td><td>本地实现word(doc、docx)、excel、pdf、ppt、csv、txt只能识别纯文本，没有图片解析能力</td><td>&#x2F;</td><td><a href="https://github.com/Deep2018530/FileParseUtil">https://github.com/Deep2018530/FileParseUtil</a></td></tr><tr><td>tesseract</td><td>Orc 识别库有java客户端 tess4j，可以训练数据。</td><td></td><td></td></tr></tbody></table><h3 id="地址解析"><a href="#地址解析" class="headerlink" title="地址解析"></a>地址解析</h3><p>根据文件链接地址，自动判断文件类型，调用对应的文件解析服务。</p><h2 id="发现-灵感广场"><a href="#发现-灵感广场" class="headerlink" title="发现&#x2F;灵感广场"></a>发现&#x2F;灵感广场</h2><p>该模块将提供抖&#x2F;快&#x2F;B&#x2F;知&#x2F;红&#x2F;视频号Top榜单，以及热门KOC&#x2F;KOL最新视频。同时海外站点提供tt&#x2F;youtubo榜单（未来结合sora等让更多的中国的koc、kol出海）。</p><p>对通过数据采集服务采集过来的数据进行展示。</p><ul><li>内容分类展示最新数据</li><li>内容搜索、分页？</li><li>添加收藏、分享</li></ul><h2 id="AI-交互功能"><a href="#AI-交互功能" class="headerlink" title="AI 交互功能"></a>AI 交互功能</h2><h3 id="Prompt-管理"><a href="#Prompt-管理" class="headerlink" title="Prompt 管理"></a>Prompt 管理</h3><p>针对业务场景，编写对应的 prompt，提升模型结果的准确性。<br>python为解释型语言，prompt可以直接在代码里写死，前期没有必要存储到数据库。</p><ul><li>总结思维导图 </li><li>总结文章 </li><li>提炼价值点 </li><li>文本翻译 </li><li>生成推荐问题 </li><li>根据图片内容写故事</li></ul><h3 id="流式输出"><a href="#流式输出" class="headerlink" title="流式输出"></a>流式输出</h3><p>模型结果支持流式输出。</p><h3 id="摘要与总结"><a href="#摘要与总结" class="headerlink" title="摘要与总结"></a>摘要与总结</h3><p>调用模型进行全文总结生成，可以选取一段内容进行摘要生成，摘要位置可以进行管理，双向定位。</p><h4 id="前端交互功能"><a href="#前端交互功能" class="headerlink" title="前端交互功能"></a>前端交互功能</h4><p>前端功能界面需要包含几个区域，大致功能如下：</p><ul><li>功能按钮区域 <ul><li>新会话 </li><li>上传文件</li></ul></li><li>文件列表区域 </li><li>文件预览区域 <ul><li>可以显示pdf、txt、视频、音频 </li><li>有笔记或摘要的位置高亮区别显示 </li><li>显示文件中的高亮内容可以定位到问答区域的对应内容</li></ul></li><li>问答区域</li></ul><img src="/2024/12/13/aiuc-technical-proposal/wps14.jpg" class="" title="img"><img src="/2024/12/13/aiuc-technical-proposal/wps15.jpg" class="" title="img"><p>针对文档，用户可以选择复制文本，然后在问答区域可以进行任意问题的提问。</p><h3 id="互动问答"><a href="#互动问答" class="headerlink" title="互动问答"></a>互动问答</h3><p>互动问答中，可以文本输入或上传文件进行多轮问答。</p><ul><li>输入校验 <ul><li>输入内容校验 </li><li>内容长度校验</li></ul></li><li>文档文字选择 <ul><li>解释 </li><li>总结</li></ul></li><li>文档内容截图框选（同chatpdf） </li><li>回答内容快速复制 </li><li>问题总数限制 </li><li>异常处理 <ul><li>异常提示文案、级别及形式</li></ul></li><li>数据存储 </li><li>历史数据加载</li></ul><h3 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h3><ul><li>笔记内容 <ul><li>文本 </li><li>图片 </li><li>视频</li></ul></li><li>笔记位置管理，可双向定位 <ul><li>记录笔记在文档中的位置 </li><li>记录笔记在音频中的位置 </li><li>记录笔记在视频中的位置</li></ul></li></ul><h3 id="多模型结果"><a href="#多模型结果" class="headerlink" title="多模型结果"></a>多模型结果</h3><p>支持多个模型的结果展示。</p><h2 id="基础功能"><a href="#基础功能" class="headerlink" title="基础功能"></a>基础功能</h2><h3 id="登录、注册"><a href="#登录、注册" class="headerlink" title="登录、注册"></a>登录、注册</h3><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><p>支持微信扫码登录、平台帐号登录和手机验证码登录。</p><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><ul><li>微信扫码登录时自动注册。 </li><li>用户自行注册。 </li><li>手机验证码登录时自动注册。</li></ul><h3 id="用户空间管理"><a href="#用户空间管理" class="headerlink" title="用户空间管理"></a>用户空间管理</h3><ul><li>文件存储空间套餐 </li><li>文件管理 </li><li>笔记、摘要管理 </li><li>基本信息管理</li></ul><h3 id="分享"><a href="#分享" class="headerlink" title="分享"></a>分享</h3><p>用户可将摘要、笔记等信息对外分享，需要一个单独的分享内容展示界面。</p><h3 id="系统管理"><a href="#系统管理" class="headerlink" title="系统管理"></a>系统管理</h3><h4 id="组织机构管理"><a href="#组织机构管理" class="headerlink" title="组织机构管理"></a>组织机构管理</h4><ul><li>对组织机构进行curd </li><li>可以给机构添加用户 </li><li>同一用户可存在多个机构中</li></ul><h4 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h4><ul><li>对用户进行curd </li><li>可以设置用户的角色，支持多选 </li><li>可以设计用户的组织机构，支持多选</li></ul><h4 id="角色管理"><a href="#角色管理" class="headerlink" title="角色管理"></a>角色管理</h4><ul><li>对角色信息进行curd </li><li>可以给角色添加用户，同一用户可拥有多个角色 </li><li>可以给角色添加功能资源，支持多选</li></ul><h4 id="功能资源管理"><a href="#功能资源管理" class="headerlink" title="功能资源管理"></a>功能资源管理</h4><ul><li>对功能资源进行curd</li></ul><h2 id="安全与风控服务"><a href="#安全与风控服务" class="headerlink" title="安全与风控服务"></a>安全与风控服务</h2><p>涉黄、涉政</p><h3 id="用户提交文件校验"><a href="#用户提交文件校验" class="headerlink" title="用户提交文件校验"></a>用户提交文件校验</h3><h3 id="模型生成内容校验"><a href="#模型生成内容校验" class="headerlink" title="模型生成内容校验"></a>模型生成内容校验</h3><h3 id="防刷"><a href="#防刷" class="headerlink" title="防刷"></a>防刷</h3><h2 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h2><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><h3 id="静态资源库（COS）"><a href="#静态资源库（COS）" class="headerlink" title="静态资源库（COS）"></a>静态资源库（COS）</h3><p>使用腾讯 cos 服务存储用户上传和自动采集的文件。</p><h3 id="缓存库"><a href="#缓存库" class="headerlink" title="缓存库"></a>缓存库</h3><p>缓存用户信息等。</p><h3 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h3><h1 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h1><img src="/2024/12/13/aiuc-technical-proposal/wps16.jpg" class="" title="img"><h1 id="资源申请"><a href="#资源申请" class="headerlink" title="资源申请"></a>资源申请</h1><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><p>应用：aiuc-web</p><p>应用：ai-aiuc-parse-com</p><h3 id="MySQL-1"><a href="#MySQL-1" class="headerlink" title="MySQL"></a>MySQL</h3><p>数据库名称: aiuc_web_DB</p><p>版本: 5.7</p><p>资源配置: 2G内存+40G硬盘</p><p>资源归属部门:</p><p>创建资源服务商: TC(腾讯云)</p><p>灾备: 跨可用区</p><p>所需hosts: aiuc-web-data-mysql-m01</p><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>资源名称: aiuc-web-cache-redis-m01</p><p>版本: 4.0</p><p>架构:分布式版(8分片)</p><p>资源配置: 1G内存</p><p>是否需要密码: 是</p><p>资源归属部门: AI事业部</p><p>创建资源服务商: TC(腾讯云)</p><p>灾备: 跨可用区</p><h2 id="成本统计"><a href="#成本统计" class="headerlink" title="成本统计"></a>成本统计</h2><table><thead><tr><th>项目</th><th>使用情况</th><th>成本</th><th>汇总</th></tr></thead><tbody><tr><td>服务器</td><td></td><td></td><td></td></tr><tr><td>Redis</td><td></td><td></td><td></td></tr><tr><td>mysql</td><td></td><td></td><td></td></tr><tr><td>大模型</td><td></td><td></td><td></td></tr><tr><td>腾讯云存储</td><td></td><td></td><td></td></tr><tr><td>总计</td><td></td><td></td><td></td></tr></tbody></table><h1 id="技术调研"><a href="#技术调研" class="headerlink" title="技术调研"></a>技术调研</h1><p>LangChain：大语言模型工具箱</p><p>参考资料：</p><p><a href="https://zhuanlan.zhihu.com/p/619729737">https://zhuanlan.zhihu.com/p/619729737</a></p><p>源码：</p><p><a href="https://github.com/kaixindelele/ChatPaper">https://github.com/kaixindelele/ChatPaper</a></p><p><a href="https://github.com/shibing624/ChatPDF">https://github.com/shibing624/ChatPDF</a></p><h2 id="业界案例"><a href="#业界案例" class="headerlink" title="业界案例"></a>业界案例</h2><h3 id="txyz"><a href="#txyz" class="headerlink" title="txyz"></a>txyz</h3><p>支持的功能</p><ul><li>非扫描件的 Pdf 文件内容解析 </li><li>内容总结 </li><li>交互提问</li></ul><p>不支持的功能</p><ul><li>不支持纯图片或扫描成图片的pdf</li></ul><h3 id="Chatpdf"><a href="#Chatpdf" class="headerlink" title="Chatpdf"></a>Chatpdf</h3><p>支持框选图表，使用gpt4解释</p><h3 id="Chatdoc"><a href="#Chatdoc" class="headerlink" title="Chatdoc"></a>Chatdoc</h3><h3 id="Chatexcel"><a href="#Chatexcel" class="headerlink" title="Chatexcel"></a>Chatexcel</h3><h3 id="Biligpt"><a href="#Biligpt" class="headerlink" title="Biligpt"></a>Biligpt</h3>]]></content>
      
      
      <categories>
          
          <category> 解决方案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI大模型应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI 内容理解平台关键模块实施方案</title>
      <link href="/2024/12/13/aiuc-key-module/"/>
      <url>/2024/12/13/aiuc-key-module/</url>
      
        <content type="html"><![CDATA[<h1 id="大文件上传截断方案"><a href="#大文件上传截断方案" class="headerlink" title="大文件上传截断方案"></a>大文件上传截断方案</h1><h2 id="方案："><a href="#方案：" class="headerlink" title="方案："></a>方案：</h2><ol><li>文档按大小限制上传（150M），按字符数限制解析存储（20w）；</li><li>视频按大小限制上传（1G），按字幕字符数限制解析存储（5w）；</li><li>按字符数，限制模型总结字符长度，见 1.1 各模型输入长度限制。</li></ol><h2 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h2><ol><li>响应速度更快，前端用户交互体验更好； </li><li>节省调用大模型成本，见 1.3 大模型费用。</li></ol><h2 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h2><ol><li>文件总结的内容不完整</li></ol><h2 id="各模型输入长度与耗时"><a href="#各模型输入长度与耗时" class="headerlink" title="各模型输入长度与耗时"></a>各模型输入长度与耗时</h2><p>各个模型单次的token输入长度限制有差异，并且请求频率也有限制，通过测试对比，以下是测试结果：</p><img src="/2024/12/13/aiuc-key-module/1.png" class=""><p><strong>最终方案如下：</strong></p><img src="/2024/12/13/aiuc-key-module/2.png" class=""><h2 id="同类产品限制"><a href="#同类产品限制" class="headerlink" title="同类产品限制"></a>同类产品限制</h2><p>通过调研发现，目前同类产品都存在以下限制：</p><img src="/2024/12/13/aiuc-key-module/3.png" class=""><h2 id="模型费用"><a href="#模型费用" class="headerlink" title="模型费用"></a>模型费用</h2><table><thead><tr><th>模型名称</th><th>输入</th><th>输出</th><th>链接</th></tr></thead><tbody><tr><td>智谱：GLM-4</td><td>0.1元&#x2F;千tokens</td><td>同输入</td><td><a href="https://open.bigmodel.cn/pricing">ZHIPU AI OPEN PLATFORM</a></td></tr><tr><td>百川：Baichuan2</td><td>0.008元&#x2F;千tokens</td><td>同输入</td><td><a href="https://platform.baichuan-ai.com/price">百川大模型-汇聚世界知识 创作妙笔生花-百川智能</a></td></tr><tr><td>Kimi：moonshot-v1-32k</td><td>0.012元&#x2F;千tokens</td><td>同输入</td><td><a href="https://apidoc-team.smzdm.com/project/2352/interface/api/58221">apidoc-team.smzdm.com</a></td></tr><tr><td>千问：qwen-72b-chat</td><td>0.02元&#x2F;千tokens</td><td>同输入</td><td><a href="https://help.aliyun.com/zh/dashscope/developer-reference/tongyi-qianwen-7b-14b-72b-metering-and-billing">help.aliyun.com</a></td></tr><tr><td>文心：ernie-speed-128k</td><td>0.004元&#x2F;千tokens</td><td>0.008元&#x2F;千tokens</td><td><a href="https://cloud.baidu.com/doc/WENXINWORKSHOP/s/hlrk4akp7">cloud.baidu.com</a></td></tr><tr><td>gpt-4</td><td>US$30.00 &#x2F; 1M tokens</td><td>US$60.00 &#x2F; 1M tokens</td><td><a href="https://openai.com/api/pricing">https://openai.com/api/pricing</a></td></tr><tr><td>gpt-35-turbo</td><td>US$0.50 &#x2F; 1M tokens</td><td>US$1.50 &#x2F; 1M tokens</td><td><a href="https://openai.com/api/pricing">https://openai.com/api/pricing</a></td></tr></tbody></table><h1 id="多模型切换场景：上下文管理方案"><a href="#多模型切换场景：上下文管理方案" class="headerlink" title="多模型切换场景：上下文管理方案"></a>多模型切换场景：上下文管理方案</h1><p>会话的第一个问题为默认问题，只要切换模型就会自动发起问答。</p><h2 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h2><ol><li><p>切换模型时，读取上一模型的问答列表存储在堆栈中；</p></li><li><p>与当前模型的问答列表对比，没有问过的留下，按顺序提示用户；</p></li><li><p>用户用户连续跳过3个问题，则清空堆栈。</p></li></ol><p>优点：</p><ol><li>轻量。</li></ol><p>缺点：</p><ol><li><p>刷新页面后丢失提示数据；</p></li><li><p>清空堆栈后所有模型都会丢失数据。</p></li></ol><h2 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h2><ol><li><p>维护一个问题堆栈和一个map，key为问题的hash，value为列表；</p></li><li><p>当开始问下一个问题时就压入堆栈，并存储该模型名称到value列表中；</p></li><li><p>切换模型时，在第一个问题回答完后，从堆栈中取问题，按顺序提示用户是否问第二、三…个问题；</p></li><li><p>如果用户问了，则记录该模型名称到value列表中，如果跳过了，也记录该模型名称到value列表中；</p></li><li><p>如果用户连续跳过了3个，则把堆栈中所有该模型没问的问题都记录一下，放在对应的value列表中；</p></li><li><p>如果用户新增问题，则继续压入堆栈中，重复2、3、4、5；</p></li><li><p>问题对应的value值存满后，可删除；</p></li><li><p>持久化该堆栈和map，应对刷新场景。</p></li></ol><p>优点：</p><ol><li>可保留所有数据。</li></ol><p>缺点：</p><ol><li>相比方案一较重，看看是否有必要。</li></ol><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hash(question)&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;zhipu&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;baichuan&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;wenxin&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 解决方案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI大模型应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 DrissionPage 实现京东登录及滑块验证</title>
      <link href="/2024/12/12/drission-page-jd-login/"/>
      <url>/2024/12/12/drission-page-jd-login/</url>
      
        <content type="html"><![CDATA[<p>使用 DrissionPage 实现京东登录及滑块验证</p><img src="/2024/12/12/drission-page-jd-login/1.png" class="" title="login"><h1 id="安装-DrissionPage"><a href="#安装-DrissionPage" class="headerlink" title="安装 DrissionPage"></a>安装 DrissionPage</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install drissionpage</span><br></pre></td></tr></table></figure><h1 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h1><p>代码这里我们要实现的主要就是两个功能：</p><ol><li>自动输入用户信息进行登录</li><li>自动操作滑块进行验证并通过</li></ol><p>这里的难点就是滑块的轨迹生成，不过值得高兴的是，登录的这个滑块目前还没有轨迹验证，在后面的商品列表获取时出现的滑块验证才是难点。</p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="JdCrawler-py"><a href="#JdCrawler-py" class="headerlink" title="JdCrawler.py"></a>JdCrawler.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"><span class="keyword">from</span> DrissionPage <span class="keyword">import</span> Chromium  </span><br><span class="line"><span class="keyword">from</span> track <span class="keyword">import</span> get_tracks  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JdCrawler</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">    京东爬虫  </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="variable language_">self</span>.browser = Chromium()  </span><br><span class="line">        <span class="variable language_">self</span>.tab = <span class="variable language_">self</span>.browser.latest_tab  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="variable language_">self</span>.tab.get(<span class="string">&#x27;https://passport.jd.com/new/login.aspx?ReturnUrl=https%3A%2F%2Fwww.jd.com%2F&#x27;</span>)  </span><br><span class="line">        <span class="variable language_">self</span>.tab.ele(<span class="string">&#x27;css:#loginname&#x27;</span>).<span class="built_in">input</span>(<span class="string">&#x27;your_jd_username&#x27;</span>)  </span><br><span class="line">        <span class="variable language_">self</span>.tab.ele(<span class="string">&#x27;css:#nloginpwd&#x27;</span>).<span class="built_in">input</span>(<span class="string">&#x27;your_jd_password&#x27;</span>)  </span><br><span class="line">        <span class="variable language_">self</span>.tab.ele(<span class="string">&#x27;css:#loginsubmit&#x27;</span>).click()  </span><br><span class="line">  </span><br><span class="line">        <span class="variable language_">self</span>.tab.wait.doc_loaded()  </span><br><span class="line">        time.sleep(<span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line">        <span class="variable language_">self</span>.verify_login_slider()  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_login_slider</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="comment"># 1.获取滑块图片  </span></span><br><span class="line">        background_bytes = <span class="variable language_">self</span>.tab.ele(<span class="string">&#x27;css:.JDJRV-bigimg img&#x27;</span>).src()  </span><br><span class="line">        cut_bytes = <span class="variable language_">self</span>.tab.ele(<span class="string">&#x27;css:.JDJRV-smallimg img&#x27;</span>).src()  </span><br><span class="line">        <span class="comment"># 2.识别滑块缺口并获取滑动轨迹  </span></span><br><span class="line">        det = ddddocr.DdddOcr(det=<span class="literal">False</span>, ocr=<span class="literal">False</span>, show_ad=<span class="literal">False</span>)  </span><br><span class="line">        result = det.slide_match(cut_bytes, background_bytes, simple_target=<span class="literal">True</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;滑块距离&quot;</span>, result)  </span><br><span class="line">        offset = result[<span class="string">&#x27;target&#x27;</span>][<span class="number">0</span>]  </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 拖动的按钮  </span></span><br><span class="line">        move_img = <span class="variable language_">self</span>.tab.ele(<span class="string">&#x27;css:.JDJRV-slide-btn&#x27;</span>)  </span><br><span class="line">        <span class="comment"># 开始拖动  </span></span><br><span class="line">        <span class="variable language_">self</span>.tab.actions.hold(move_img)  </span><br><span class="line">        tracks = get_tracks(offset * <span class="number">342</span> / <span class="number">360</span>)  <span class="comment"># 342/360 为背景图片的实际宽度和渲染宽度之比  </span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;轨迹&quot;</span>, tracks)  </span><br><span class="line">        <span class="comment"># 向前滑动  </span></span><br><span class="line">        <span class="keyword">for</span> track <span class="keyword">in</span> tracks[<span class="string">&#x27;move_list&#x27;</span>]:  </span><br><span class="line">            <span class="variable language_">self</span>.tab.actions.move(offset_x=track, offset_y=random.uniform(-<span class="number">7.5</span>, <span class="number">10.5</span>),  </span><br><span class="line">                                  duration=random.uniform(<span class="number">0.01</span>, <span class="number">0.05</span>))  </span><br><span class="line">  </span><br><span class="line">        <span class="variable language_">self</span>.tab.actions.release(move_img)  </span><br><span class="line">        time.sleep(<span class="number">1</span>)  </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.tab.ele(<span class="string">&#x27;css:#JDJRV-wrap-loginsubmit&#x27;</span>).style(<span class="string">&#x27;display&#x27;</span>) != <span class="string">&#x27;none&#x27;</span>:  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;滑块验证失败，重新验证&quot;</span>)  </span><br><span class="line">            <span class="variable language_">self</span>.verify_login_slider()  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;滑块验证通过&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    jd = JdCrawler()  </span><br><span class="line">    jd.login()  </span><br></pre></td></tr></table></figure><h2 id="track-py"><a href="#track-py" class="headerlink" title="track.py"></a>track.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_tracks</span>(<span class="params">distance</span>):  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;滑块运动轨迹&quot;&quot;&quot;</span>  </span><br><span class="line">    value = <span class="built_in">round</span>(random.uniform(<span class="number">0.55</span>, <span class="number">0.75</span>), <span class="number">2</span>)  </span><br><span class="line">    v, t, sum1 = <span class="number">0</span>, <span class="number">0.3</span>, <span class="number">0</span>  </span><br><span class="line">    plus = []  </span><br><span class="line">    mid = distance * value  </span><br><span class="line">    <span class="keyword">while</span> sum1 &lt; distance:  </span><br><span class="line">        <span class="keyword">if</span> sum1 &lt; mid:  </span><br><span class="line">            a = <span class="built_in">round</span>(random.uniform(<span class="number">2.5</span>, <span class="number">3.5</span>), <span class="number">1</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            a = -<span class="built_in">round</span>(random.uniform(<span class="number">2.0</span>, <span class="number">3.5</span>), <span class="number">1</span>)  </span><br><span class="line">        s = v * t + <span class="number">0.5</span> * a * (t ** <span class="number">2</span>)  </span><br><span class="line">        v = v + a * t  </span><br><span class="line">        sum1 += s  </span><br><span class="line">        plus.append(<span class="built_in">round</span>(s))  </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;move_list&quot;</span>: plus&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> DrissionPage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>探索数据的无限可能：欢迎来到 AnalyzeSphere！</title>
      <link href="/2024/11/05/AnalyzeSphere/"/>
      <url>/2024/11/05/AnalyzeSphere/</url>
      
        <content type="html"><![CDATA[<p>今天和大家分享一个新产品，它可能会改变你对数据分析的看法。</p><h1 id="什么是-AnalyzeSphere？"><a href="#什么是-AnalyzeSphere？" class="headerlink" title="什么是 AnalyzeSphere？"></a>什么是 <a href="https://www.analyze-sphere.com/">AnalyzeSphere</a>？</h1><p>简单来说，<a href="https://www.analyze-sphere.com/">AnalyzeSphere</a> 是一个超级强大的数据分析工具，旨在帮助你更轻松地理解和利用数据。无论你是企业主、市场营销人员，还是只对数据感兴趣的朋友，我们都希望这个工具能为你带来帮助。</p><h1 id="为什么选择我们？"><a href="#为什么选择我们？" class="headerlink" title="为什么选择我们？"></a>为什么选择我们？</h1><ul><li><p><strong>简单易用</strong>：我们知道，很多数据工具都复杂得让人头疼。<a href="https://www.analyze-sphere.com/">AnalyzeSphere</a> 采用直观的界面设计，让你可以快速上手，不用再花时间去学习繁琐的操作。</p></li><li><p><strong>智能分析</strong>：我们的智能算法会自动帮你找出数据中的趋势和模式，让你能够快速做出决策。这就像有一个聪明的小助手在旁边为你工作！</p></li><li><p><strong>实时更新</strong>：在这个瞬息万变的世界里，我们确保你的数据始终保持最新，让你随时随地都能掌握一手信息。</p></li></ul><h1 id="适合谁？"><a href="#适合谁？" class="headerlink" title="适合谁？"></a>适合谁？</h1><p>无论你是想要深入了解市场动态的创业者，还是希望优化业务流程的团队成员，<a href="https://www.analyze-sphere.com/">AnalyzeSphere</a> 都能为你提供所需的洞察力。我们相信，数据应该是每个人都能轻松获取和理解的资源。</p><h1 id="试试看吧！"><a href="#试试看吧！" class="headerlink" title="试试看吧！"></a>试试看吧！</h1><p>如果你对这个工具感兴趣，不妨访问 <a href="https://www.analyze-sphere.com/">AnalyzeSphere</a>，了解更多信息。非常期待听到你的反馈，也希望能帮助你在数据的海洋中找到属于自己的航道！</p><p>谢谢你的关注，希望我们能一起探索数据的无限可能！</p>]]></content>
      
      
      <categories>
          
          <category> 我的产品 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI大模型应用 </tag>
            
            <tag> 市场分析 </tag>
            
            <tag> 出海 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>提升商品检索结果相关性</title>
      <link href="/2024/02/12/Improve-the-relevance-of-search-results/"/>
      <url>/2024/02/12/Improve-the-relevance-of-search-results/</url>
      
        <content type="html"><![CDATA[<p><strong>命中前提：</strong></p><ol><li>库里存在该商品或与该商品有关联</li><li>关键词尽可能属于商品 title 的子串，或和商品 title 相关</li><li>关键词不能只有型号，要有品牌等信息</li><li>价格区间需要正确传入</li></ol><h1 id="检索服务流程"><a href="#检索服务流程" class="headerlink" title="检索服务流程"></a>检索服务流程</h1><p>前端通过交互界面，输入一段 query，发送请求到检索服务，检索服务根据该 query 去库里查，分别查 ES 库和 Milvus 库，查出来之后通过 RRF 做个排序，然后把结果返回给前端。</p><p>这样做的话，结果的准确性完全取决于用户的关键词是什么。</p><p>这里涉及到几个关键环节：</p><ol><li><p>用户输入 query 环节</p></li><li><p>服务接收并处理 query 环节</p></li><li><p>根据 query 查询数据库环节</p></li><li><p>从库中查询到数据返回给用户环节</p></li></ol><img src="/2024/02/12/Improve-the-relevance-of-search-results/wps1.png" class=""><h1 id="优化方案"><a href="#优化方案" class="headerlink" title="优化方案"></a>优化方案</h1><img src="/2024/02/12/Improve-the-relevance-of-search-results/wps2.png" class=""> <h2 id="用户输入-query-环节"><a href="#用户输入-query-环节" class="headerlink" title="用户输入 query 环节"></a>用户输入 query 环节</h2><p>在用户输入环节进行优化，提供输入联想、纠错等功能。</p><p>针对微信公众号这种前端输入无法控制的场景，可能无法在输入这块直接提供优化，但是也可以后置，比如发送完了之后再问一下用户是否要修改为以下提供的 query 等。</p><h3 id="输入联想"><a href="#输入联想" class="headerlink" title="输入联想"></a>输入联想</h3><p>首先需要提供一个 query 模板库，该模板即为用户常输入的一些句式，然后通过用户输入的商品填充用户的输入。在输入到商品时，需要实时从库里查出对应的商品建议提示给用户。</p><p>这块需要准备句式模板库、库里的商品列表。</p><h3 id="纠错"><a href="#纠错" class="headerlink" title="纠错"></a>纠错</h3><p>根据模板和库里的商品，进行实时纠错。纠错时需要提示用户确认。</p><h2 id="服务接收并处理-query-环节"><a href="#服务接收并处理-query-环节" class="headerlink" title="服务接收并处理 query 环节"></a>服务接收并处理 query 环节</h2><p>服务接收到 query 后，对该 query 做一个预处理，该预处理可以将用户的 query 进行分词、纠错、意图理解、上下文理解、商品提取等操作。</p><h3 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h3><p>分词的目的是为了更好的命中库中的数据，需要根据<strong>业务场景、库里已有的数据</strong>进行针对性分词。</p><p>需要实现的模块：</p><ol><li><p>业务关键词库</p></li><li><p>商品关键词库</p></li></ol><h3 id="纠错-1"><a href="#纠错-1" class="headerlink" title="纠错"></a>纠错</h3><p>根据模板和库里的商品，进行纠错。纠错时需要提示用户确认。如果没有前一环节的纠错时启用该环节。</p><p>需要实现的模块：</p><ol><li><p>模板库</p></li><li><p>纠错服务</p></li></ol><h3 id="意图理解"><a href="#意图理解" class="headerlink" title="意图理解"></a>意图理解</h3><p>模型能力实现。</p><p>理解用户具体想要什么商品。</p><ol><li><p>模型自身的理解能力</p></li><li><p>结合业务、商品库以及商品检索服务生成可提取准确关键词的意图理解</p></li></ol><h3 id="上下文理解"><a href="#上下文理解" class="headerlink" title="上下文理解"></a>上下文理解</h3><p>模型能力实现。</p><p>结合上下文理解用户具体想要什么商品。</p><h3 id="目标商品提取"><a href="#目标商品提取" class="headerlink" title="目标商品提取"></a>目标商品提取</h3><p>目标商品提取，使用库里的商品列表进行比对。这里需要考虑到商品的简称、别称等，可能也需要维护一个库。</p><p>目前提取出来的关键词存在不明确的场景，比如输入blackberry手机，提取出来的关键词有：黑莓9900,P9981,9982,9983，第一个带有黑莓，其他的都只有型号，型号单独当关键词去商品库里查询时，结果和目标商品会差很多。</p><p>故，这里需要使用品牌加型号的方式当关键词。</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><img src="/2024/02/12/Improve-the-relevance-of-search-results/wps3.png" class=""></td><td><img src="/2024/02/12/Improve-the-relevance-of-search-results/wps4.jpg" class=""></td></tr></tbody></table><h4 id="提取逻辑"><a href="#提取逻辑" class="headerlink" title="提取逻辑"></a>提取逻辑</h4><p>根据用户输入的 query，通过百科、评价总结等 tool 返回结果，再将几轮对话的上下文作为参数去调用百川模型，最终提取出来关键词。</p><h3 id="句式模板库"><a href="#句式模板库" class="headerlink" title="句式模板库"></a>句式模板库</h3><h3 id="商品列表"><a href="#商品列表" class="headerlink" title="商品列表"></a>商品列表</h3><h2 id="根据-query-查询数据库环节"><a href="#根据-query-查询数据库环节" class="headerlink" title="根据 query 查询数据库环节"></a>根据 query 查询数据库环节</h2><p>这个环节主要依赖数据库自身能力，能优化的就是数据源和查询参数。</p><p>根据 query 查询数据库环节中，通过优化 ES 的匹配查询能力，以及 Milvus 的向量查询能力。</p><h3 id="ES"><a href="#ES" class="headerlink" title="ES"></a>ES</h3><p>ES 的匹配查询能力和分词器有关系，可以优化分词器配置或自定义分词器。</p><h3 id="Milvus"><a href="#Milvus" class="headerlink" title="Milvus"></a>Milvus</h3><p>Milvus 的向量查询能力，依赖对源数据的向量化及查询参数。</p><p>目前是使用商品的 title 字段进行的向量化，查询参数 nprobe 为 128。</p><h2 id="从库中查询到数据返回给用户环节"><a href="#从库中查询到数据返回给用户环节" class="headerlink" title="从库中查询到数据返回给用户环节"></a>从库中查询到数据返回给用户环节</h2><h3 id="RRF-排序"><a href="#RRF-排序" class="headerlink" title="RRF 排序"></a>RRF 排序</h3><p>从库里查询到结果之后，目前是做了 RRF 的排序，即 ES 和 Milvus 都命中的排在前面。</p><p>目前 RRF 的 K 值是 60。</p><h3 id="反向验证"><a href="#反向验证" class="headerlink" title="反向验证"></a>反向验证</h3><p>将查询到的结果和目标商品再进行一次反向匹配，校验库的查询能力，命中的排在前面。</p>]]></content>
      
      
      <categories>
          
          <category> 解决方案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 优化 </tag>
            
            <tag> 检索 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
